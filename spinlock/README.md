Spinlock implementation with some optimizations
